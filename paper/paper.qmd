---
title: "Why Did Russia Fare So Poorly during COVID: An Analysis of why one of the Best Prepared Countries could not control Excess Deaths"
author: 
  - Aryaman Sharma
  - Aviral Bhardwaj
  - Janel Gilani
thanks: "Code and data are available at: https://github.com/Ary4m3n/covid-effect-russia.git; Replication on Social Science Reproduction platform available at: "
date: today
date-format: long
abstract: "First sentence. Second sentence. Third sentence. Fourth sentence."
format: pdf
toc: true
number-sections: true
bibliography: references.bib
---

```{r}
#| include: false
#| warning: false
#| message: false

library(tidyverse)
library(palmerpenguins)
library(ggplot2)
library(janitor)
library(dplyr)
library(rnaturalearth)
library(sf)
library(knitr)
```


# Introduction

The COVID-19 pandemic has led to an enormous loss of life over the world and has presented an unprecedented challenge to public health, foreign policy and has additionally had an adverse effect on countries' economies around the world, over the past 5 years [@citeWHOeffect]. There have been over 774 million reported confirmed cases of the virus being contract and the outbreak has caused over 7 million deaths, which are claimed to be "under counted" and "under reported", suggesting that the actual number is even higher around 18.2 - 33.5 million based on the excess mortality estimates [@citeWikiCOVID]. This excessively high number of deaths has alerted the world to assess how countries assumed to be well-prepared to tackle such outbreaks were affected to this extent.

There were a subset of countries, namely India, the United States of America, Brazil, Russia and Mexico which were impacted the most in terms of having the highest cumulative total deaths [@citeThinkGlobalHealth]. According to the global data, Russia's COVID-19 related deaths since the start of the pandemic have been over 230,000. Russia also holds the highest mortality rate in Europe and the second-highest rate in Asia [@citeCarnegieRussia]. For these reasons and more, Russia and its residents have suffered a lot over the past few years, wherein the adverse impact of the outbreak has lead to a plethora of impacts on the country's economy and standard of living. 

This paper will follow a reproduction of Jennifer B. Nuzzo and Jorge R. Ledesma's paper [@citeRepPaper] and findings and apply a Russian-facing lens to discuss the impact of the COVID-19 outbreak on Russia and what could have been done better and can be improved for the future in order for the impact of any upcoming pandemics can be lessened. Our paper aims to replicate their claim of how well-prepared countries did so poorly during the COVID-19 outbreak, where the Nuzzo and Ledesma have concentrated solely on the United States but in this paper we look at Russia with the same regards and analyse the impact of the pandemic on the death toll, and finally provide for ways to improve the laws, regulations and plans to tackle such outbreaks in the future. Our reproduction found out that how ever well prepared Russia seemed to be, it experienced an unprecedented rise in the death rate compared to other countries, and its excess death rate was one of the highest amongst all countries. This leads us to make an important judgement that better planning and regulations can help reduce the impact of such outbreaks in the future, which will be studied in this paper.

This paper is structured using the following sections: Data, Results and Discussion. In the Data (@sec-data) section, the data source of the datasets from the paper being replicated [@citeRepPaper] is discussed and the measurement and data cleaning process is outlined. In the Results (@sec-results) section, the paper summarizes the data findings and presents relevant maps and plots in order to study the trends. The paper ends with the Discussion (@sec-discussion) section, where the findings of the paper have been analysed and delved deeper into by studying the measures that can be taken to prevent the country from experiencing such an extensive effect of future pandemics. Additionally, the limitations and a further scope for the paper has been discussed here.

```{r}
#| echo: false
#| warning: false
#| message: false
cleaned_ghs_index_data_2021 <- read_csv("../data/analysis_data/cleaned_GHS_index.csv")

world <- ne_countries(scale = "medium", returnclass = "sf")

world_scores <- merge(world, cleaned_ghs_index_data_2021, by.x = "name", by.y = "country", all.x = TRUE)

world_scores$score_factor <- cut(
  world_scores$overall_score, 
  breaks = c(16, 25, 30, 35, 40, 45, 50, 60, 70, 76), 
  labels = c("16 to 25", "25 to 30", "30 to 35", "35 to 40", "40 to 45", "45 to 50", "50 to 60", "60 to 70", "70 to 76"), 
  include.lowest = TRUE)

ggplot(data = world_scores) +
  geom_sf(aes(fill = score_factor), color = "white") +
  scale_fill_manual(values = c("#990000", "#CC3333", "#FF6666", "#FF9966", "#FFCC99", "#99CCFF", "#6699CC", "#336699", "#003399")) +
  labs(fill = "Global health security score", title = "Global Health Security Score (2021)") +
  theme_minimal()
```

```{r}
#| echo: false
#| warning: false
#| message: false
cleaned_deaths_data <- read_csv("../data/analysis_data/cleaned_all_cause_dth_rates.csv")

cleaned_deaths_data_long <- pivot_longer(cleaned_deaths_data, cols = -country_name, names_to = "Year", values_to = "Value")

cleaned_deaths_data_long[,-1] <- lapply(cleaned_deaths_data_long[,-1], as.numeric)

cleaned_deaths_data_fit <- cleaned_deaths_data_long |>
  filter(Year >= 2010 & Year <= 2019)

ggplot(cleaned_deaths_data_long, aes(x = Year, y = Value, group = country_name, color = country_name)) +
  geom_line(aes(color = country_name)) +
  geom_point(aes(color = country_name)) +
  geom_smooth(data = cleaned_deaths_data_fit, method = "lm", se = FALSE, aes(color = country_name), linetype = "dashed", size = 0.5) +
  geom_smooth(data = cleaned_deaths_data_long, method = "lm", se = FALSE, aes(color = country_name), linetype = "dotted", size = 1) +
  theme_minimal() +
  scale_x_continuous(breaks = 2010:2021) +
  labs(title = "Values Over Years by Country", x = "Year", y = "Value") +
  theme(legend.title = element_blank())
```

```{r}
#| echo: false
#| warning: false
#| message: false

# Model: India
model_india <- lm(Value ~ Year, data = cleaned_deaths_data_fit |> filter(country_name == "India"))
# Predicting 2020 and 2021
coefficients_ind <- coef(model_india)
ind_2020 <- (coefficients_ind["Year"] * 2020) + coefficients_ind["(Intercept)"]
ind_2021 <- (coefficients_ind["Year"] * 2021) + coefficients_ind["(Intercept)"]
# Ratio
ind <- cleaned_deaths_data_long |>
  filter(country_name == "India")
excess_ind_2020 <- ind$Value[11] - ind_2020
excess_ind_2021 <- ind$Value[12] - ind_2021

# Model: Russian Federation
model_rus <- lm(Value ~ Year, data = cleaned_deaths_data_fit |> filter(country_name == "Russian Federation"))
# Predicting 2020 and 2021
coefficients_rus <- coef(model_rus)
rus_2020 <- (coefficients_rus["Year"] * 2020) + coefficients_rus["(Intercept)"]
rus_2021 <- (coefficients_rus["Year"] * 2021) + coefficients_rus["(Intercept)"]
# Ratio
rus <- cleaned_deaths_data_long |>
  filter(country_name == "Russian Federation")
excess_rus_2020 <- rus$Value[11] - rus_2020
excess_rus_2021 <- rus$Value[12] - rus_2021

# Model: United States
model_us <- lm(Value ~ Year, data = cleaned_deaths_data_fit |> filter(country_name == "United States"))
# Predicting 2020 and 2021
coefficients_us <- coef(model_us)
us_2020 <- (coefficients_us["Year"] * 2020) + coefficients_us["(Intercept)"]
us_2021 <- (coefficients_us["Year"] * 2021) + coefficients_us["(Intercept)"]
# Ratio
us <- cleaned_deaths_data_long |>
  filter(country_name == "United States")
excess_us_2020 <- us$Value[11] - us_2020
excess_us_2021 <- us$Value[12] - us_2021

# Model: South Korea
model_sk <- lm(Value ~ Year, data = cleaned_deaths_data_fit |> filter(country_name == "Korea, Rep."))
# Predicting 2020 and 2021
coefficients_sk <- coef(model_sk)
sk_2020 <- (coefficients_sk["Year"] * 2020) + coefficients_sk["(Intercept)"]
sk_2021 <- (coefficients_sk["Year"] * 2021) + coefficients_sk["(Intercept)"]
# Ratio
sk <- cleaned_deaths_data_long |>
  filter(country_name == "Korea, Rep.")
excess_sk_2020 <- sk$Value[11] - sk_2020
excess_sk_2021 <- sk$Value[12] - sk_2021

excess_deaths <- tibble(
  Year = c(2020, 2020, 2020, 2020, 2021, 2021, 2021, 2021),
  country_name = rep(c("India", "Russian Federation", "United States", "Korea, Rep."), times = 2),
  Value = c(excess_ind_2020, excess_rus_2020, excess_us_2020, excess_sk_2020, excess_ind_2021, excess_rus_2021, excess_us_2021, excess_sk_2021) |> round(2)
)

ggplot(excess_deaths, aes(x = country_name, y = Value, fill = as.factor(Year))) +
  geom_bar(stat = "identity", position = position_dodge(), width = 0.7) +
  coord_flip() +  # Flip coordinates to make the bar plot horizontal
  theme_minimal() +
  labs(title = "Value by Country and Year", x = "Country", y = "Value") +
  scale_fill_manual(values = c("2021" = "cyan4", "2020" = "cadetblue2"), name = "Year") +
  geom_text(aes(label = Value), position = position_dodge(width = 0.8), color = "black")
```

```{r}
#| echo: false
#| warning: false
#| message: false
combined_data <- read_csv("../data/analysis_data/cleaned_excess_death_ghs.csv")

ggplot(combined_data, aes(x = ghs_index, y = excess_death_rate, label = country)) +
  geom_point(aes(color = ifelse(country %in% c("USA", "Russia"), "Highlight", "Normal"))) +
  scale_color_manual(values = c("Highlight" = "red", "Normal" = "black")) +
  guides(color = FALSE) +
  geom_text(vjust = 1.2, hjust = 0.5) +
  geom_smooth(method = "lm", se = FALSE, color = "#669900") +
  labs(title = "Scatterplot of Excess Death Rate vs GHS Index",
       x = "Global Health Security Index",
       y = "Excess Death Rate") +
  theme_minimal()
```

# Data {#sec-data}

Some of our data is of penguins (@fig-bills), from @palmerpenguins.

```{r}
#| label: fig-bills
#| fig-cap: Bills of penguins
#| echo: false

ggplot(penguins, aes(x = island, fill = species)) +
  geom_bar(alpha = 0.8) +
  scale_fill_manual(values = c("darkorange","purple","cyan4"),
                    guide = "none") +
  theme_minimal() +
  facet_wrap(~species, ncol = 1) +
  coord_flip()
```

Talk more about it.

And also planes (@fig-planes). (You can change the height and width, but don't worry about doing that until you have finished every other aspect of the paper - Quarto will try to make it look nice and the defaults usually work well once you have enough text.)

```{r}
#| label: fig-planes
#| fig-cap: Relationship between wing length and width
#| echo: false
#| warning: false
#| message: false

analysis_data <- read_csv(here::here("data/analysis_data/analysis_data.csv"))

analysis_data |> 
  ggplot(aes(x = width, y = length)) +
  geom_point(alpha = 0.8) +
  theme_minimal() +
  labs(x = "Wing width (mm)",
       y = "Wing length (mm)")
```

Talk way more about it. 



# Model

The goal of our modelling strategy is twofold. Firstly,...

Here we briefly describe the Bayesian analysis model used to investigate... Background details and diagnostics are included in [Appendix -@sec-model-details].

## Model set-up

Define $y_i$ as the number of seconds that the plane remained aloft. Then $\beta_i$ is the wing width and $\gamma_i$ is the wing length, both measured in millimeters.  

\begin{align} 
y_i|\mu_i, \sigma &\sim \mbox{Normal}(\mu_i, \sigma) \\
\mu_i &= \alpha + \beta_i + \gamma_i\\
\alpha &\sim \mbox{Normal}(0, 2.5) \\
\beta &\sim \mbox{Normal}(0, 2.5) \\
\gamma &\sim \mbox{Normal}(0, 2.5) \\
\sigma &\sim \mbox{Exponential}(1)
\end{align}

We run the model in R [@citeR] using the `rstanarm` package of @rstanarm. We use the default priors from `rstanarm`.


### Model justification

We expect a positive relationship between the size of the wings and time spent aloft. In particular...

We can use maths by including latex between dollar signs, for instance $\theta$.


# Results {#sec-results}

Our results are summarized in @tbl-modelresults.

```{r}
#| echo: false
#| eval: true
#| warning: false
#| message: false

library(rstanarm)

first_model <-
  readRDS(file = here::here("models/first_model.rds"))
```

```{r}
#| echo: false
#| eval: true
#| label: tbl-modelresults
#| tbl-cap: "Explanatory models of flight time based on wing width and wing length"
#| warning: false

modelsummary::modelsummary(
  list(
    "First model" = first_model
  ),
  statistic = "mad",
  fmt = 2
)
```




# Discussion {#sec-discussion}

## First discussion point {#sec-first-point}

If my paper were 10 pages, then should be be at least 2.5 pages. The discussion is a chance to show off what you know and what you learnt from all this. 

## Second discussion point

## Third discussion point

## Weaknesses and next steps

Weaknesses and next steps should also be included.

\newpage

\appendix

# Appendix {-}


# Additional data details

# Model details {#sec-model-details}

## Posterior predictive check

In @fig-ppcheckandposteriorvsprior-1 we implement a posterior predictive check. This shows...

In @fig-ppcheckandposteriorvsprior-2 we compare the posterior with the prior. This shows... 

```{r}
#| eval: true
#| echo: false
#| message: false
#| warning: false
#| label: fig-ppcheckandposteriorvsprior
#| layout-ncol: 2
#| fig-cap: "Examining how the model fits, and is affected by, the data"
#| fig-subcap: ["Posterior prediction check", "Comparing the posterior with the prior"]

pp_check(first_model) +
  theme_classic() +
  theme(legend.position = "bottom")

posterior_vs_prior(first_model) +
  theme_minimal() +
  scale_color_brewer(palette = "Set1") +
  theme(legend.position = "bottom") +
  coord_flip()
```

## Diagnostics

@fig-stanareyouokay-1 is a trace plot. It shows... This suggests...

@fig-stanareyouokay-2 is a Rhat plot. It shows... This suggests...

```{r}
#| echo: false
#| eval: true
#| message: false
#| warning: false
#| label: fig-stanareyouokay
#| fig-cap: "Checking the convergence of the MCMC algorithm"
#| fig-subcap: ["Trace plot", "Rhat plot"]
#| layout-ncol: 2

plot(first_model, "trace")

plot(first_model, "rhat")
```



\newpage


# References


